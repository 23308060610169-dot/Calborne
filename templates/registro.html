{% extends "base.html" %}
{% block title %}Registro - Paso {{ step }}{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-7">
      <div class="card gothic-card p-4 border-danger">
        <h3 class="text-danger text-center mb-3">Registro — Paso {{ step }} de {{ total_steps }}</h3>

        <form method="POST">
          {% if step == 1 %}
            <div class="mb-3">
              <label class="form-label">Correo electrónico</label>
              <input class="form-control gothic-input" name="email" type="email" required value="{{ registro.get('email','') }}">
            </div>
            <div class="mb-3">
              <label class="form-label">Contraseña</label>
              <input class="form-control gothic-input" name="password" type="password" required>
            </div>

          {% elif step == 2 %}
            <div class="mb-3">
              <label class="form-label">Nombre</label>
              <input class="form-control gothic-input" name="nombre" value="{{ registro.get('nombre','') }}" required>
            </div>

          {% elif step == 3 %}
            <div class="mb-3">
              <label class="form-label">Apellido</label>
              <input class="form-control gothic-input" name="apellido" value="{{ registro.get('apellido','') }}" required>
            </div>

          {% elif step == 4 %}
            <div class="mb-3">
              <label class="form-label">Edad</label>
              <input class="form-control gothic-input" name="edad" type="number" min="0" value="{{ registro.get('edad','') }}">
            </div>

          {% elif step == 5 %}
            <div class="mb-3">
              <label class="form-label">Sexo</label>
              <select class="form-select gothic-input" name="sexo">
                <option value="">Selecciona</option>
                <option value="female" {% if registro.get('sexo')=='female' %}selected{% endif %}>Mujer</option>
                <option value="male" {% if registro.get('sexo')=='male' %}selected{% endif %}>Hombre</option>
              </select>
            </div>

          {% elif step == 6 %}
            <div class="mb-3">
              <label class="form-label">Peso (kg)</label>
              <input class="form-control gothic-input" name="peso" type="number" step="0.1" value="{{ registro.get('peso','') }}">
            </div>

          {% elif step == 7 %}
            <div class="mb-3">
              <label class="form-label">Altura (cm)</label>
              <input class="form-control gothic-input" name="altura" type="number" step="0.1" value="{{ registro.get('altura','') }}">
            </div>

          {% elif step == 8 %}
            <div class="mb-3">
              <label class="form-label">Nivel de actividad</label>
              <input class="form-control gothic-input" name="actividad" placeholder="ej. baja, moderada, alta" value="{{ registro.get('actividad','') }}">
            </div>

          {% elif step == 9 %}
            <div class="mb-3">
              <label class="form-label">Objetivo principal</label>
              <select class="form-select gothic-input" name="objetivo">
                <option value="">Selecciona</option>
                <option value="bajar" {% if registro.get('objetivo')=='bajar' %}selected{% endif %}>Bajar de peso</option>
                <option value="aumentar" {% if registro.get('objetivo')=='aumentar' %}selected{% endif %}>Aumentar masa muscular</option>
                <option value="mantener" {% if registro.get('objetivo')=='mantener' %}selected{% endif %}>Mantener peso</option>
                <option value="digestión" {% if registro.get('objetivo')=='digestión' %}selected{% endif %}>Mejorar digestión</option>
                <option value="control_condicion" {% if registro.get('objetivo')=='control_condicion' %}selected{% endif %}>Controlar condición (diabetes, hipertensión...)</option>
              </select>
            </div>

          {% elif step == 10 %}
            <div class="mb-3">
              <label class="form-label">Alergias (ej. maní, mariscos) — separa por comas</label>
              <input class="form-control gothic-input" name="alergias" value="{{ registro.get('alergias','') }}">
            </div>

          {% elif step == 11 %}
            <div class="mb-3">
              <label class="form-label">Intolerancias (ej. lactosa, gluten) — separa por comas</label>
              <input class="form-control gothic-input" name="intolerancias" value="{{ registro.get('intolerancias','') }}">
            </div>

          {% elif step == 12 %}
            <div class="mb-3">
              <label class="form-label">Dietas o preferencias (vegana, vegetariana, keto, mediterránea, etc.)</label>
              <input class="form-control gothic-input" name="dieta" value="{{ registro.get('dieta','') }}">
            </div>

          {% elif step == 13 %}
            <div class="mb-3">
              <label class="form-label">Alimentos que no te gustan (separa por comas)</label>
              <input class="form-control gothic-input" name="alimentos_no_gustan" value="{{ registro.get('alimentos_no_gustan','') }}">
            </div>

          {% elif step == 14 %}
            <div class="mb-3">
              <label class="form-label">Nivel de experiencia en cocina</label>
              <select class="form-select gothic-input" name="experiencia_cocina">
                <option value="">Selecciona</option>
                <option value="principiante" {% if registro.get('experiencia_cocina')=='principiante' %}selected{% endif %}>Principiante</option>
                <option value="aficionado" {% if registro.get('experiencia_cocina')=='aficionado' %}selected{% endif %}>Chef aficionado</option>
                <option value="experto" {% if registro.get('experiencia_cocina')=='experto' %}selected{% endif %}>Experto</option>
              </select>
            </div>

          {% elif step == 15 %}
            <div class="mb-3">
              <label class="form-label">Condiciones médicas o restricciones (opcional)</label>
              <textarea class="form-control gothic-input" name="condiciones_medicas" rows="3">{{ registro.get('condiciones_medicas','') }}</textarea>
            </div>

          {% elif step == 16 %}
            <div class="mb-3">
              <label class="form-label">¿Deseas que las calorías no alcanzadas se acumulen al día siguiente?</label>
              <div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="acumular_calorias" id="acum_si" value="si" {% if registro.get('acumular_calorias')=='si' %}checked{% endif %}>
                  <label class="form-check-label" for="acum_si">Sí</label>
                </div>
                <div class="form-check form-check-inline">
                  <input class="form-check-input" type="radio" name="acumular_calorias" id="acum_no" value="no" {% if registro.get('acumular_calorias','no')!='si' %}checked{% endif %}>
                  <label class="form-check-label" for="acum_no">No</label>
                </div>
              </div>
            </div>

          {% elif step == total_steps %}
            <h5 class="text-light">Revisar datos</h5>
            <pre class="bg-dark text-light p-3 small">{{ registro | tojson(indent=2) }}</pre>
            <div class="form-text mb-3 text-secondary">Revisa tus respuestas. Puedes agregar la cuenta o omitir y volver al inicio.</div>
            <div class="d-flex gap-2">
              <button name="action" value="agregar" class="btn btn-danger">Agregar cuenta</button>
              <button name="action" value="omitir" class="btn btn-outline-danger">Omitir y volver al inicio</button>
            </div>
          {% endif %}

          {% if step < total_steps %}
            <div class="mt-3 d-flex justify-content-between">
              {% if step > 1 %}
                <a class="btn btn-outline-secondary" href="{{ url_for('registro', step=step-1) }}">Atrás</a>
              {% else %}
                <span></span>
              {% endif %}
              <button class="btn btn-danger">Siguiente</button>
            </div>
          {% endif %}
        </form>

      </div>
    </div>
  </div>
</div>
{% endblock %}